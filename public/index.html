<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="lyricsformatter.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="script_formatter.js"></script>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-e3b0a8b1e4095176f4a6f42c37b4efb51337fba6c937e281a5f3800f76475893" crossorigin="anonymous">
    <title>LyricsFormatter</title>
</head>

    <body>
        <div class="top">
            <div class="return">
                <img class="return_arrow" id="return_arrow" src="images\arrow.svg" alt="Return Arrow" title="Return to Home" draggable="false" style="display:none">
            </div>
            <div class="page_title">LyricsFormatter</div>
            <div class="settings">
                <img class="options_dots" id="settings_dots" src="images\options.svg" alt="Options" title="Options" draggable="false" style="display:block">
                <!-- Mini menu -->
                <div id="mini_menu" class="mini-menu">
                    <ul>
                        <li id="settings_option" style="display:block; border-radius: 10px;">
                            <p>Settings</p>
                        </li>
                        <li id="credits_option" style="display:block; border-radius: 10px;">
                            <p>Credits</p>
                        </li>
                        <li id="suggest_option" style="display:none; border-radius: 10px;">
                            <p>Suggest a Feature</p>
                        </li>
                        <li id="about_option" style="display:block; border-radius: 10px;">
                            <p>About This Tool</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    
        <div class="main">
            <div class="main_content">
                <div class="main_left">
                    <div class="lyrics_box" id="lyrics_box">
                        <div class="editor-container">
                            <div class="line_issues" id="line_issues"></div>
                            <div class="character_counter"></div>
                            <textarea class="editor" id="editor" placeholder="Paste the lyrics here..." oninput="checkContent();"></textarea>
                        </div>
                    </div>
                </div>
                <div class="main_right">
                    <div class="language_selector">
                        <div class="lang_selector_div" title="Tap to see list of supported languages">
                            <div class="selected_language">Select Language</div>
                            <div class="mobile_footer_arrow">
                                <img class="lang_expand_arrow" id="lang_expand_arrow" src="images/expand_arrow.svg" alt="Expand Arrow" draggable="false">
                            </div>
                        </div>
                        <ul class="language_list" id="language_list">
                            <li data-lang="en-UK">English (UK)</li>
                            <li data-lang="en-US">English (US)</li>
                            <li data-lang="nl" style="display:none">Dutch</li>
                            <li data-lang="fr">French<span class="new_tag">new</span></li>
                            <li data-lang="de" style="display:none">German<span class="new_tag">new</span></li>
                            <li data-lang="it">Italian<span class="beta_tag">beta</span></li>
                            <li data-lang="pt-BR">Portuguese (BR)</li>
                            <li data-lang="pt-PT">Portuguese (PT)</li>
                            <li data-lang="es">Spanish<span class="new_tag">new</span></li>
                            <p>More languages soon...</p>
                        </ul>
                    </div>
                    <div class="improvements_box" style="height: calc(90% - 100px);">
                        <div class="improvements_box_top">
                            <div class="improvements_box_text">
                                <p>Suggestions</p>
                            </div>
                            <div class="improvements_box_buttons" style="">
                                <div class="reset_div">
                                    <button class="reset_button" id="reset_button" style="display:none" title="Reset transcription" onclick="resetTranscription()">
                                        <div class="reset_symbol"></div>
                                    </button>
                                </div>
                                <div class="refresh_div">
                                    <button class="refresh_button" id="refresh_button" style="display:none" title="Refresh suggestions" onclick="handleRefreshButtonClick()">
                                        <div class="refresh_symbol"></div>
                                    </button>
                                    <div class="loading_spinner_loop" id="loading_spinner" style="display:none">
                                        <div class="loading_spinner">
                                          <div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="improvements_box_content">
                            <div class="improvements" id="improvements_containers">
                                <div class="improvements_placeholder_div" id="improvements_placeholder_div">
                                    <div class="improvements_placeholder" id="improvements_placeholder">Type something or paste your transcription to start...</div>
                                </div>
                            </div>                            
                        </div>
                    </div>
                    <div class="sp_player_div" id="sp_player_div" style="display:none; margin-bottom: 45px">
                        <div class="sp_player_div_content">
                            <div class="sp_search" style="display:none">
                                <div class="search-container">
                                    <input type="text" placeholder="Paste a Spotify track ID or URL" id="search_input">
                                    <button type="submit" style="" id="search_btn">Search</button>
                                    <div class="loading_spinner_loop" id="loading_spinner" style="display:none">
                                      <div class="loading_spinner">
                                        <div></div>
                                      </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sp_player">
                                <div class="spotify_player">
                                    <div class="sp_web_player">
                                        <div class="sp_left">
                                            <div class="sp_album_art" id="sp_album_art"></div>
                                        </div>
                                        <div class="sp_right">
                                            <div class="song-info">
                                                <p class="sp_title" id="sp_title"></p>
                                                <p class="sp_album" id="sp_album"></p>
                                                <p class="sp_artist" id="sp_artist"></p>
                                            </div>
                                        </div>      
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mobile_expanded_content" id="mobile_expanded_content">
                <div class="main_right">
                    <div class="language_selector"></div>
                    <div class="improvements_box"></div>
                    <div class="sp_player_div"></div>
                </div>
            </div>
        </div>
        <div id="notification" class="hidden">
            <div class="notification-content">
              <p id="notification-message"></p>
            </div>
        </div>
        <div class="player" id="sdk_player">
            <script src="https://sdk.scdn.co/spotify-player.js"></script>
            <div class="control-container" id="play_pause">
                <svg viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8 5V19M16 5V19" stroke="#ffffff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                <svg fill="#ffffff" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="0.00032" style="display:none; margin-left: 7px"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>play</title> <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path> </g></svg>
            </div>
            <div class="controls-center">
                <input type="range" id="tracker" min="0" value="0" max="100">
            </div>
            <div class="controls-right">
                <div class="control-container" id="previous_section">
                    <img src="images/backward.svg" alt="Backward">
                </div>
                <div class="control-container" id="3s_backward" style="position: relative;">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M12.0016 3.47945C11.9216 3.47945 11.8416 3.48945 11.7616 3.48945L12.5816 2.46945C12.8416 2.14945 12.7916 1.66945 12.4616 1.41945C12.1316 1.16945 11.6716 1.20945 11.4116 1.53945L9.44156 3.99945C9.43156 4.00945 9.43156 4.01945 9.42156 4.03945C9.39156 4.07945 9.37156 4.12945 9.35156 4.16945C9.33156 4.21945 9.31156 4.25945 9.30156 4.29945C9.29156 4.34945 9.29156 4.38945 9.29156 4.43945C9.29156 4.48945 9.29156 4.53945 9.29156 4.58945C9.29156 4.60945 9.29156 4.61945 9.29156 4.63945C9.30156 4.66945 9.32156 4.68945 9.33156 4.71945C9.35156 4.76945 9.37156 4.80945 9.39156 4.85945C9.42156 4.89945 9.45156 4.93945 9.49156 4.96945C9.51156 4.99945 9.52156 5.02945 9.55156 5.04945C9.57156 5.05945 9.58156 5.06945 9.60156 5.07945C9.63156 5.09945 9.65156 5.10945 9.68156 5.11945C9.73156 5.14945 9.79156 5.16945 9.85156 5.17945C9.88156 5.19945 9.91156 5.19945 9.94156 5.19945C9.97156 5.19945 9.99156 5.20945 10.0216 5.20945C10.0516 5.20945 10.0716 5.19945 10.0916 5.18945C10.1216 5.18945 10.1516 5.19945 10.1816 5.18945C10.8216 5.03945 11.4216 4.96945 11.9916 4.96945C16.4816 4.96945 20.1316 8.61945 20.1316 13.1095C20.1316 17.5994 16.4816 21.2495 11.9916 21.2495C7.50156 21.2495 3.85156 17.5994 3.85156 13.1095C3.85156 11.3695 4.42156 9.68945 5.50156 8.24945C5.75156 7.91945 5.68156 7.44945 5.35156 7.19945C5.02156 6.94945 4.55156 7.01945 4.30156 7.34945C3.02156 9.04945 2.35156 11.0395 2.35156 13.1095C2.35156 18.4195 6.67156 22.7495 11.9916 22.7495C17.3116 22.7495 21.6316 18.4295 21.6316 13.1095C21.6316 7.78945 17.3116 3.47945 12.0016 3.47945Z" fill="#ffffff"></path>
                        </g>
                    </svg>
                    <p style="position: absolute; top: 54%; left: 51%; color: #ffffff; font-size: small; transform: translate(-50%, -50%); z-index: 1;" id="backwardValue"></p>
                </div>
                </div>
                <div class="control-container" id="3s_forward" style="position: relative;">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M19.4791 7.09052C19.2191 6.77052 18.7491 6.72052 18.4291 6.98052C18.1091 7.24052 18.0591 7.71052 18.3191 8.03052C19.4491 9.43052 20.0791 11.0905 20.1391 12.8305C20.2991 17.3105 16.7791 21.0905 12.2891 21.2405C7.79906 21.4005 4.02906 17.8805 3.86906 13.4005C3.70906 8.92052 7.22906 5.14052 11.7191 4.99052C12.2891 4.97052 12.8891 5.02052 13.5391 5.15052C13.5791 5.16052 13.6191 5.15052 13.6591 5.15052C13.7591 5.20052 13.8791 5.23052 13.9891 5.23052C14.1591 5.23052 14.3191 5.18052 14.4591 5.06052C14.7791 4.80052 14.8291 4.33052 14.5791 4.01052L12.5991 1.54052C12.3391 1.22052 11.8691 1.16052 11.5491 1.42052C11.2291 1.68052 11.1791 2.15052 11.4291 2.47052L12.2591 3.50052C12.0691 3.49052 11.8691 3.48052 11.6791 3.49052C6.36906 3.67052 2.19906 8.15052 2.38906 13.4605C2.57906 18.7705 7.04906 22.9405 12.3591 22.7505C17.6691 22.5605 21.8391 18.0905 21.6491 12.7805C21.5591 10.7105 20.8191 8.74052 19.4791 7.09052Z" fill="#ffffff"></path>         
                        </g>
                    </svg>
                    <p style="position: absolute; top: 54%; left: 49%; color: #ffffff; font-size: small; transform: translate(-50%, -50%); z-index: 1;" id="forwardValue"></p>
                </div>
                <div class="control-container" id="next_section">
                    <img src="images/forward.svg" alt="Forward">
                </div>
            </div>
        </div>
        <div class="footer" id="footer">

            <div class="footer_message">Please note that this tool only provides suggestions based on your current transcription. It is still essential to thoroughly review all the content before sending.</div>
        </div>    
        <div class="development_message">
            <h2>Mobile Interface Under Development</h2>
            <p>The interface for mobile devices is still under development. Please use a PC for the best experience.</p>
        </div>

        <div id="overlay"></div>

        <div id="settings_popup" class="popup">
            <div id="closeButton" onclick="closeSettings()">&#215;</div>
            <div class="popup_title">
                <h2 onclick="handleSettingsClick()">Settings</h2>
            </div>
            <div class="popup_content">
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Spotify account</p>
                        <p class="popup_option_description">Connect your Spotify account to LyricsFormatter</p>
                    </div>
                    <div class="spotify_login" id="spotify_login_button" style="display:block">
                        <button class="spotify_button" id="spotify_button">
                            <img src="images/spotify_logo.webp" alt="Spotify Logo" class="spotify_logo">
                            Login with Spotify
                        </button>
                    </div>
                    <div class="user-profile" id="user_profile" style="display:none">
                        <img class="user-photo" id="sp_user_pic" src="#" alt="User Photo" title="User Photo" draggable="false">
                        <div id="user_menu" class="user-menu">
                            <ul>
                                <li id="disconnect_option" style="border-radius: 10px;">
                                    <p>Disconnect account</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Autoplay</p>
                        <p class="popup_option_description">Automatically transfer the playback to LyricsFormatter upon opening the website.</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="spAutoPlay" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Backwards value</p>
                        <p class="popup_option_description">Specify the duration in seconds to rewind during backward playback</p>
                    </div>
                    <div class="number_selector">
                        <svg class="arrow left" viewBox="0 0 24 24" onclick="decreaseValue('selectedValue1')">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg>
                        <span id="selectedValue1">3</span>
                        <svg class="arrow right" viewBox="0 0 24 24" onclick="increaseValue('selectedValue1')">
                            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                        </svg>
                    </div>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Fast forward value</p>
                        <p class="popup_option_description">Specify the duration in seconds to fast forward during playback</p>
                    </div>
                    <div class="number_selector">
                        <svg class="arrow left" viewBox="0 0 24 24" onclick="decreaseValue('selectedValue2')">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg>
                        <span id="selectedValue2">3</span>
                        <svg class="arrow right" viewBox="0 0 24 24" onclick="increaseValue('selectedValue2')">
                            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                        </svg>
                    </div>
                </div>
                <hr style="border-top: 1px solid rgb(100, 100, 100); border-right: none; border-bottom: none; border-left: none; border-image: initial;">
                <div class="popup_option" style="display:none">
                    <div class="popup_title">
                        <p class="popup_option_title">Character counter</p>
                        <p class="popup_option_description">Select this option for the character counter</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="characterCounterToggle" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Auto capitalization</p>
                        <p class="popup_option_description">Select this option to automatically capitalize the first letter of the lines</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoCapToggle" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Auto trim lines</p>
                        <p class="popup_option_description">Select this option to automatically trim the lines</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoTrimToggle" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Remove duplicate lines and spaces</p>
                        <p class="popup_option_description">Select this option to automatically remove duplicate spaces and lines</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="removeDoubleSpacesAndLinesToggle" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Auto capitalize tags</p>
                        <p class="popup_option_description">Select this option to automatically capitalize tags</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoCapTagsToggle" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="popup_option">
                    <div class="popup_title">
                        <p class="popup_option_title">Automatic suggestions</p>
                        <p class="popup_option_description">Select this option for automatic format suggestions</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoSuggestions" onclick="checkContent()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="dev_hided_div" id="dev_hided_div" style="display:none">
                    <hr style="border-top: 1px solid rgb(100, 100, 100); border-right: none; border-bottom: none; border-left: none; border-image: initial;">
                    <div class="popup_option">
                        <div class="popup_title">
                            <p class="popup_option_title">Development mode</p>
                            <p class="popup_option_description">Select this option to switch to the local server</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="localHostToggle" onclick="checkContent()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div id="credits_popup" class="popup">
            <div id="closeButton" onclick="closeCredits()">&#215;</div>
            <div class="popup_title">
                <h2>Credits</h2>
            </div>
            <div class="popup_description">
                <p></p>
            </div>
            <div class="popup_content" style="display: flex; align-items: center;">
                <div class="loading_container" id="loading_container">
                    <div class="loading_spinner_loop" id="loading_spinner_credits" style="display:block">
                        <div class="loading_spinner">
                            <div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="suggest_popup" class="popup">
            <div id="closeButton" onclick="closeSuggestions()">&#215;</div>
            <div class="popup_title">
                <h2>Suggest a feature</h2>
            </div>
            <div class="popup_description">
                <p></p>
            </div>
            <div class="popup_content" style="display: flex; align-items: center;">
                <form>
                    <select name="select_menu" id="select_menu" onchange="updateOptions()">
                        <option value="" disabled selected>Select an option</option>
                        <option value="option1">Suggest word for the dictionary</option>
                        <option value="option2">Suggest a new format alert</option>
                        <option value="option3">Send a feedback</option>
                        <option value="option4">Report a bug</option>
                    </select>
                    <br>
                    <input type="text" name="text1" style="display: none;">
                    <br>
                    <input type="text" name="text2" style="display: none;">
                    <br>
                    <input type="text" name="text3" style="display: none;">
                    <br>
                    <textarea type="text" name="text4" style="display: none; word-wrap: break-word;"></textarea>
                </form>
            </div>
        </div>

        <div id="about_popup" class="popup">
            <div id="closeButton" onclick="closeAboutInfo()">&#215;</div>
            <div class="popup_title">
                <h2>About this tool</h2>
            </div>
            <div class="popup_description">
            </div>
            <div class="popup_content" id="aboutContent" style="display: flex; align-items: center;">
                <div class="loading_container" id="loading_container">
                    <div class="loading_spinner_loop" id="loading_spinner_credits" style="display:block">
                        <div class="loading_spinner">
                            <div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>

                window.onSpotifyWebPlaybackSDKReady = () => {
                    const token = localStorage.getItem('accessToken');
                    const player = new Spotify.Player({
                        name: 'LyricsFormatter Player',
                        getOAuthToken: cb => { cb(token); },
                        volume: 1.0
                    });

                    // Ready
                    player.addListener('ready', ({ device_id }) => {
                        console.log('Ready with Device ID', device_id);
                    });

                    // Not Ready
                    player.addListener('not_ready', ({ device_id }) => {
                        console.log('Device ID has gone offline', device_id);
                    });

                    player.addListener('initialization_error', ({ message }) => {
                        console.error(message);
                    });

                    player.addListener('authentication_error', ({ message }) => {
                        console.error(message);
                    });

                    player.addListener('account_error', ({ message }) => {
                        console.error(message);
                    });

                    player.connect();

                    document.getElementById('play_pause').onclick = function() {
                        player.togglePlay();
                    };

                    document.getElementById('3s_backward').onclick = function() {
                        rewind(document.getElementById('selectedValue1').textContent)
                    };

                    document.getElementById('3s_forward').onclick = function() {
                        fastForward(document.getElementById('selectedValue2').textContent)
                    };;

                    // CÓDIGO QUE TRATA DOS COMANDOS DO TECLADO
                    document.addEventListener('keydown', function(event) {

                        // Recuperar os tokens do armazenamento local do navegador
                        const accessToken = localStorage.getItem('accessToken');
                        const refreshToken = localStorage.getItem('refreshToken');

                        // Verificar se os tokens estão em cache
                        if (!accessToken || !refreshToken) {
                            return; // sair da função porque não há tokens do Spotify
                        }

                        var numericKeys = ['0', '1', '3', '4', '5', '6'];

                        // verifica se a tecla pressionada está no numpad
                        var isNumpadKey = (event.location === KeyboardEvent.DOM_KEY_LOCATION_NUMPAD);

                        if (numericKeys.includes(event.key) && isNumpadKey) {
                            switch (event.key) {
                                case '1':
                                    rewind(document.getElementById('selectedValue1').textContent)
                                    break;
                                case '3':
                                     fastForward(document.getElementById('selectedValue2').textContent)
                                    break;
                                case '4':
                                    console.log("Clique no botão 4 identificado: voltar para estrofe anterior")
                                    break;
                                case '5':
                                    console.log("Clique no botão 5 identificado: reproduzir estrofe atual novamente")
                                    break;
                                case '6':
                                    console.log("Clique no botão 6 identificado: pular para próxima estrofe")
                                    break;
                                case '0':
                                    player.togglePlay();
                                    break;
                                default:
                                    // outras teclas (não são tratadas)
                                    break;
                            }
                        }

                        // Event listener para controlar quando uma música termina
                        player.addListener('player_state_changed', state => {
                            if (!state || !state.position) {
                                // Se o estado não estiver disponível ou a posição for indefinida, resete o valor do tracker
                                document.getElementById('tracker').value = 0;
                            }
                        });

                    });

                    // Função para atualizar a barra de progresso com base na posição atual da música
                    function updateProgressBar(position, duration) {
                        const tracker = document.getElementById('tracker');
                        if (duration > 0) {
                            const progress = (position / duration) * 100;
                            tracker.value = progress;
                        }
                    }

                    // Playback State Changed
                    player.addListener('player_state_changed', state => {
                        console.log('Playback state changed:', state);
                        if (state && state.position && state.duration) {
                            const newPosition = state.position;
                            const duration = state.duration;
                            updateProgressBar(newPosition, duration);
                        }
                    });

                    // Função para iniciar o efeito de progresso na barra de progresso
                    function startProgressEffect() {
                        const interval = 0.5 * 1000; // Intervalo em milissegundos (0.5 segundos)
                        setInterval(() => {
                            player.getCurrentState().then(state => {
                                if (state) {
                                    const newPosition = state.position;
                                    const duration = state.duration;
                                    updateProgressBar(newPosition, duration);
                                }
                            });
                        }, interval);
                    }

                    // Chama a função para iniciar o efeito de progresso na barra de progresso
                    startProgressEffect();

                    // Objeto para armazenar as posições atuais de cada música
                    const positions = {};

                    // Função para retroceder uma quantidade específica de segundos na reprodução
                    function rewind(seconds) {
                        player.getCurrentState().then(state => {
                            if (state) {
                                const milliseconds = seconds * 1000; // Convertendo segundos para milissegundos
                                const newPosition = Math.max(0, state.position - milliseconds);
                                player.seek(newPosition).then(() => {
                                    console.log(`Rewound to ${newPosition} milliseconds`);
                                    positions[state.track.id] = newPosition; // Atualiza a posição para a música atual
                                });
                            }
                        });
                    }

                    // Função para avançar uma quantidade específica de segundos na reprodução
                    function fastForward(seconds) {
                        player.getCurrentState().then(state => {
                            if (state) {
                                const milliseconds = seconds * 1000; // Convertendo segundos para milissegundos
                                const newPosition = Math.min(state.duration, state.position + milliseconds);
                                player.seek(newPosition).then(() => {
                                    console.log(`Fast forwarded to ${newPosition} milliseconds`);
                                    positions[state.track.id] = newPosition; // Atualiza a posição para a música atual
                                });
                            }
                        });
                    }

                    // Quando uma nova música é reproduzida, obtenha a posição atual se estiver disponível
                    player.on('track_change', () => {
                        player.getCurrentState().then(state => {
                            if (state) {
                                positions[state.track.id] = state.position; // Armazena a posição para a nova música
                            }
                        });
                    });

                };


                function checkContent() {

                        const checkboxIds = [
                            'characterCounterToggle',
                            'autoCapToggle',
                            'autoTrimToggle',
                            'removeDoubleSpacesAndLinesToggle',
                            'autoCapTagsToggle',
                            'autoSuggestions',
                            'localHostToggle'
                        ];

                        checkboxIds.forEach(function (checkboxId) {
                            const checkbox = document.getElementById(checkboxId);
                            localStorage.setItem(checkboxId, checkbox.checked);
                        });
                        setCheckboxStates();
                }

                function handleSettingsClick() {
                    clickCount++;

                    // Se o usuário clicou 5 vezes, exibir a div e reiniciar a contagem
                    if (clickCount === 5) {
                        displayDevModeDiv();
                        clickCount = 0;
                    }
                }

                // Função para exibir/ocultar a div e salvar a escolha em cache
                function displayDevModeDiv() {
                    const devHidedDiv = document.getElementById('dev_hided_div');
                    const devMode = localStorage.getItem('devMode') === 'true'; // Obtém o estado atual do modo de desenvolvimento

                    // Alterna entre exibir e ocultar a div
                    if (devMode) {
                        devHidedDiv.style.display = 'none';
                    } else {
                        devHidedDiv.style.display = 'block';
                    }

                    // Salva a escolha em cache invertendo o valor atual
                    localStorage.setItem('devMode', (!devMode).toString());
                }

                // Carrega a escolha do modo de desenvolvimento do cache e exibe/oculta a div conforme necessário
                function loadDevMode() {
                    const devMode = localStorage.getItem('devMode') === 'true';
                    const devHidedDiv = document.getElementById('dev_hided_div');

                    if (devMode) {
                        devHidedDiv.style.display = 'block';
                    } else {
                        devHidedDiv.style.display = 'none';
                    }
                }
                loadDevMode();


                document.addEventListener('DOMContentLoaded', function () {
                    var expandArrow = document.getElementById('expand_arrow');
                    var footer = document.getElementById('footer');
                    var footerHidedContent = document.getElementById('footer_hided_content');
                    var mobileFooterDiv = document.getElementById('mobile_footer_div');

                    expandArrow.addEventListener('click', function (event) {
                        event.stopPropagation(); // Impede que o clique seja propagado para o corpo/documento
                        footer.classList.toggle('expanded');

                        if (footer.classList.contains('expanded')) {
                            footerHidedContent.style.display = "block";
                            mobileFooterDiv.style.height = "8%";
                            expandArrow.style.transform = "rotate(180deg)";
                        } else {
                            footerHidedContent.style.display = "none";
                            mobileFooterDiv.style.height = "100%";
                            expandArrow.style.transform = "rotate(0deg)";
                        }
                    });

                    // Adiciona um ouvinte de eventos ao corpo/documento para fechar o footer quando clicar fora dele
                    document.body.addEventListener('click', function (event) {
                        if (!footer.contains(event.target)) {
                            // Se o clique ocorreu fora do footer, oculta o conteúdo e recolhe o footer
                            footerHidedContent.style.display = "none";
                            mobileFooterDiv.style.height = "100%";
                            expandArrow.style.transform = "rotate(0deg)";
                            footer.classList.remove('expanded');
                        }
                    });
                });
                function closeSettings() {
                    var settingsPopup = document.getElementById("settings_popup");
                    var overlay = document.getElementById("overlay");
                    settingsPopup.style.display = "none";
                    overlay.style.display = "none";
                }
                function closeCredits() {
                    var creditsPopup = document.getElementById("credits_popup");
                    var overlay = document.getElementById("overlay");
                    creditsPopup.style.display = "none";
                    overlay.style.display = "none";
                }
                function closeSuggestions() {
                    var suggestPopup = document.getElementById("suggest_popup");
                    var overlay = document.getElementById("overlay");
                    suggestPopup.style.display = "none";
                    overlay.style.display = "none";
                }
                function closeAboutInfo() {
                    var aboutPopup = document.getElementById("about_popup");
                    var overlay = document.getElementById("overlay");
                    aboutPopup.style.display = "none";
                    overlay.style.display = "none";
                }

                function increaseValue(selectedId) {
                    var selectedValue = parseInt(document.getElementById(selectedId).textContent);
                    if (selectedValue < 15) {
                        selectedValue++;
                        updateSelectedValue(selectedId, selectedValue);
                    }
                }

                function decreaseValue(selectedId) {
                    var selectedValue = parseInt(document.getElementById(selectedId).textContent);
                    if (selectedValue > 3) {
                        selectedValue--;
                        updateSelectedValue(selectedId, selectedValue);
                    }
                }

                 // Função para obter os valores armazenados no localStorage ou definir padrões
                function getStoredValue(id) {
                    return localStorage.getItem(id) || '5'; // Valor padrão é 5 segundos
                }

                // Função para armazenar os valores selecionados no localStorage
                function setStoredValue(id, value) {
                    localStorage.setItem(id, value);
                }

                // Função para carregar os valores armazenados e definir os elementos correspondentes
                function loadStoredValues() {
                    document.getElementById('selectedValue1').textContent = getStoredValue('selectedValue1');
                    document.getElementById('selectedValue2').textContent = getStoredValue('selectedValue2');
                    document.getElementById('backwardValue').textContent = getStoredValue('selectedValue1');
                    document.getElementById('forwardValue').textContent = getStoredValue('selectedValue2');
                }

                function updateSelectedValue(id, value) {
                    document.getElementById(id).textContent = value;
                    setStoredValue(id, value); // Armazenar o valor selecionado no localStorage
                    // Atualizar os elementos <p> com base nos valores selecionados
                    if (id === 'selectedValue1') {
                        document.getElementById('backwardValue').textContent = value;
                    } else if (id === 'selectedValue2') {
                        document.getElementById('forwardValue').textContent = value;
                    }
                    // Aqui você pode fazer qualquer outra ação necessária com o valor selecionado
                }

                // Carregar os valores armazenados ao carregar a página
                window.onload = function() {
                    loadStoredValues();
                };


                // Função para atualizar as opções abaixo com base na seleção do menu seletor
                function updateOptions() {
                    var selectMenu = document.getElementById("select_menu");
                    var text1 = document.getElementsByName("text1")[0];
                    var text2 = document.getElementsByName("text2")[0];
                    var text3 = document.getElementsByName("text3")[0];
                    var text4 = document.getElementsByName("text4")[0];

                    // Verifica a opção selecionada
                    var selectedOption = selectMenu.value;

                    // Remove todas as classes dos elementos de texto
                    text1.classList.remove("option1", "option2", "option3", "option4");
                    text2.classList.remove("option1", "option2", "option3", "option4");
                    text3.classList.remove("option1", "option2", "option3", "option4");
                    text4.classList.remove("option1", "option2", "option3", "option4");

                    // Adiciona as classes apropriadas com base na opção selecionada
                    switch (selectedOption) {
                        case "option1": // Suggest word for the dictionary
                            text1.classList.add("option1");
                            text1.placeholder = "Digite o seu nome";
                            text1.style.display = "block"

                            text2.classList.add("option1");
                            text2.placeholder = "Digite aqui as palavras incorretas (separe cada uma usando uma '/')";
                            text2.style.display = "block"; 

                            text3.classList.add("option1");
                            text3.placeholder = "Digite aqui a correção";
                            text3.style.display = "block"; 

                            text4.classList.add("popup_details");
                            text4.placeholder = "Observações";
                            text4.style.display = "block"; 
                            break;
                        case "option2": // Suggest a new format alert
                            text1.classList.add("option2");
                            text1.placeholder = "Digite o seu nome";
                            text1.style.display = "block"

                            text2.classList.add("option2");
                            text2.placeholder = "Format suggestion";
                            text2.style.display = "block"; 

                            text3.classList.add("option2");
                            text3.placeholder = "Digite aqui a correção";
                            text3.style.display = "block"; 

                            text4.classList.add("popup_details");
                            text4.placeholder = "Observações";
                            text4.style.display = "block"; 
                            break;
                        case "option3": // Send a feedback
                            text1.classList.add("option3");
                            text1.placeholder = "Digite o seu nome";
                            text1.style.display = "block"

                            text2.classList.add("option3");
                            text2.placeholder = "Enter your feedback";
                            text2.style.display = "block"; 

                            text3.classList.add("option3");
                            text3.placeholder = "Digite aqui a correção";
                            text3.style.display = "none"; 

                            text4.classList.add("popup_details");
                            text4.placeholder = "Observações";
                            text4.style.display = "none"; 
                            break;
                        case "option4": // Report a bug
                            text1.classList.add("option4");
                            text1.placeholder = "Digite o seu nome";
                            text1.style.display = "block"

                            text2.classList.add("option4");
                            text2.placeholder = "Enter the bug details";
                            text2.style.display = "block"; // Exibe o segundo campo de texto

                            
                            text3.classList.add("option4");
                            text3.placeholder = "Digite aqui a correção";
                            text3.style.display = "none"; 

                            text4.classList.add("popup_details");
                            text4.placeholder = "Observações";
                            text4.style.display = "none"; 
                            break;
                        default:
                            break;
                    }
                }
        </script>
    </body>
</html>


